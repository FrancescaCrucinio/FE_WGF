\documentclass[a4paper]{amsart}
\usepackage[margin = 2.5cm]{geometry}
\usepackage[english]{babel}
\usepackage[utf8]{inputenc}
\usepackage{amsmath,amsthm}
\usepackage{amssymb}
\usepackage{enumitem}
\usepackage{graphicx, subfig}
\captionsetup[figure]{width=.85\textwidth}
\captionsetup[subfigure]{margin=0pt}
\usepackage[hidelinks]{hyperref}
\usepackage[round]{natbib}
\usepackage{tikz}
\usetikzlibrary{positioning, shapes, calc, arrows.meta}
\usepackage{xspace}

% maths
\newcommand{\HH}{\ensuremath{\mathbb{H}}\xspace}
\newcommand{\X}{\ensuremath{\mathbb{X}}\xspace}
\newcommand{\Y}{\ensuremath{\mathbb{Y}}\xspace}
\def\real{\mathbb{R}}
\newcommand{\norm}[2]{\ensuremath{\Vert #1 \Vert_{#2}}}
\newcommand{\supnorm}[1]{\norm{#1}{\infty}}
\DeclareMathOperator{\N}{\mathcal{N}}
\DeclareMathOperator{\KL}{KL}

\begin{document}
Integral equation:
\begin{align*}
\nu(y) = \int_{\X} \varrho(x)K(x, y)\ dx \qquad \forall y\in \Y
\end{align*}
with
\begin{align*}
& \nu(y) = \N(y; \mu, \sigma_{\nu}^2:= \sigma_{\rho}^2 + \sigma_K^2)\\
& \varrho(x) = \N(x; \mu, \sigma_{\rho}^2)\\
& K(x, y) = \N(y; x, \sigma_K^2)
\end{align*}
where $\X = \Y = \real$.

McKean-Vlasov SDE:
\begin{align*}
dX_t = -\int \nu(dy)\frac{\nabla K(X_t, y)}{\varrho_tK(y)}\ dt + \sqrt{2\lambda}dW_t,\qquad X_0\sim \varrho_0 
\end{align*}
discretised using Euler-Maruyama method
\begin{align*}
X_{n+1} = X_n -\int \nu(dy)\frac{\nabla K(X_n, y)}{\varrho_n K(y)}\ \Delta t + \sqrt{2\lambda}\Delta W_n,\qquad X_0\sim \varrho_0 
\end{align*}
where $\Delta W_n \sim \N(0, \Delta t^2)$.

Take $X_0\sim \N(\mu, \sigma_0^2)$. Then
\begin{align*}
\int \nu(dy)\frac{\nabla K(X_0, y)}{\varrho_0 K(y)} &= \int \N(y; \mu, \sigma_{\nu}^2)\frac{y - X_0}{\sigma_K^2}\frac{\N(y; X_0, \sigma_K^2)}{\N(y; \mu, \sigma_K^2 + \sigma_0^2)}\ dy\\
&= \frac{\sqrt{\sigma_K^2 + \sigma_0^2}}{\sqrt{2\pi}\sigma_K^3\sigma_{\nu}}\int (y - X_0)\exp\left( -(y - \mu)^2\left(\frac{1}{2\sigma_{\nu}^2} - \frac{1}{2(\sigma_K^2 + \sigma_0^2)} \right)\right)\exp\left( -\frac{(y - X_0)^2}{2\sigma_K^2}\right)\ dy\\
&= \exp\left( -\mu^2\frac{\sigma_K^2 + \sigma_0^2 - \sigma_{\nu}^2}{2\sigma_{\nu}^2(\sigma_K^2 + \sigma_0^2)} - \frac{X_0^2}{2\sigma_K^2}\right)\frac{\sqrt{\sigma_K^2 + \sigma_0^2}}{\sqrt{2\pi}\sigma_K^3\sigma_{\nu}}\\
&\int (y - X_0)\exp\left( \frac{-y^2(\beta + \gamma)+2y(\mu \beta + X_0\gamma)}{2\sigma_K^2\sigma_{\nu}^2(\sigma_K^2 + \sigma_0^2)}\right)\ dy
\end{align*}
where $\beta := \sigma_K^4 + \sigma_K^2\sigma_0^2 - \sigma_{\nu}^2\sigma_K^2$ and $\gamma := \sigma_{\nu}^2(\sigma_K^2 + \sigma_0^2)$.

The exponential inside the integral becomes
\begin{align*}
\exp\left( \frac{-y^2(\beta + \gamma)+2y(\mu \beta + X_0\gamma)}{2\sigma_K^2\sigma_{\nu}^2(\sigma_K^2 + \sigma_0^2)}\right) &= \exp\left( \frac{-y^2+2y(\mu \beta + X_0\gamma)/(\beta + \gamma)}{2\sigma_K^2\sigma_{\nu}^2(\sigma_K^2 + \sigma_0^2)(\beta + \gamma)^{-1}}\right)\\
&= \exp\left( \frac{-\left(y - (\mu \beta + X_0\gamma)/(\beta + \gamma)\right)^2}{2\sigma_K^2\sigma_{\nu}^2(\sigma_K^2 + \sigma_0^2)(\beta + \gamma)^{-1}}\right)\exp\left( \frac{\left((\mu \beta + X_0\gamma)/(\beta + \gamma)\right)^2}{2\sigma_K^2\sigma_{\nu}^2(\sigma_K^2 + \sigma_0^2)(\beta + \gamma)^{-1}}\right)\\
&= \frac{\sqrt{2\pi}\sigma_K\sigma_{\nu}\sqrt{\sigma_K^2 + \sigma_0^2}}{\sqrt{\beta + \gamma}}\N\left(y; \frac{\mu \beta + X_0\gamma}{\beta + \gamma}, \sigma_K^2\sigma_{\nu}^2(\sigma_K^2 + \sigma_0^2)(\beta + \gamma)^{-1}\right)\\
&\exp\left( \frac{\left((\mu \beta + X_0\gamma)/(\beta + \gamma)\right)^2}{2\sigma_K^2\sigma_{\nu}^2(\sigma_K^2 + \sigma_0^2)(\beta + \gamma)^{-1}}\right).
\end{align*}
Thus
\begin{align*}
\int \nu(dy)\frac{\nabla K(X_0, y)}{\varrho_0 K(y)} &= \exp\left( -\mu^2\frac{\sigma_K^2 + \sigma_0^2 - \sigma_{\nu}^2}{2\sigma_{\nu}^2(\sigma_K^2 + \sigma_0^2)} - \frac{X_0^2}{2\sigma_K^2}\right)\frac{\sqrt{\sigma_K^2 + \sigma_0^2}}{\sqrt{2\pi}\sigma_K^3\sigma_{\nu}}\exp\left( \frac{\left((\mu \beta + X_0\gamma)/(\beta + \gamma)\right)^2}{2\sigma_K^2\sigma_{\nu}^2(\sigma_K^2 + \sigma_0^2)(\beta + \gamma)^{-1}}\right)\\
&\frac{\sqrt{2\pi}\sigma_K\sigma_{\nu}\sqrt{\sigma_K^2 + \sigma_0^2}}{\sqrt{\beta + \gamma}}\int (y - X_0)\N\left(y; \frac{\mu \beta + X_0\gamma}{\beta + \gamma}, \sigma_K^2\sigma_{\nu}^2(\sigma_K^2 + \sigma_0^2)(\beta + \gamma)^{-1}\right)\ dy\\
&= \frac{(\sigma_K^2 + \sigma_0^2)}{\sigma_K^2\sqrt{\beta + \gamma}}\exp\left( -\frac{(\mu^2\beta + X_0^2\gamma)(\beta + \gamma)}{2\sigma_K^2\sigma_{\nu}^2(\sigma_K^2 + \sigma_0^2)(\beta + \gamma)}\right)\exp\left( \frac{\left(\mu \beta + X_0\gamma\right)^2}{2\sigma_K^2\sigma_{\nu}^2(\sigma_K^2 + \sigma_0^2)(\beta + \gamma)}\right)\left(\frac{\mu \beta + X_0\gamma}{\beta + \gamma} - X_0\right)\\
&= \frac{(\sigma_K^2 + \sigma_0^2)}{\sigma_K^2\sqrt{\beta + \gamma}}\exp\left( -\frac{\beta\gamma\left(\mu - X_0\right)^2}{2\sigma_K^2\sigma_{\nu}^2(\sigma_K^2 + \sigma_0^2)(\beta + \gamma)}\right)\left(\frac{\mu \beta + X_0\gamma}{\beta + \gamma} - X_0\right)\\
&= \frac{(\sigma_K^2 + \sigma_0^2)}{\sigma_K^2\sqrt{\beta + \gamma}}\exp\left(- \frac{\beta\gamma\left(\mu - X_0\right)^2}{2\sigma_K^2\sigma_{\nu}^2(\sigma_K^2 + \sigma_0^2)(\beta + \gamma)}\right)\frac{(\mu - X_0)\beta}{\beta + \gamma}\\
&= \frac{(\sigma_K^2 + \sigma_0^2)(\sigma_K^2 + \sigma_0^2 - \sigma_{\nu}^2)}{(\beta + \gamma)^{3/2}}\exp\left(- \frac{\beta\gamma\left(\mu - X_0\right)^2}{2\sigma_K^2\sigma_{\nu}^2(\sigma_K^2 + \sigma_0^2)(\beta + \gamma)}\right)(\mu - X_0)\\
&= \frac{(\sigma_K^2 + \sigma_0^2)(\sigma_K^2 + \sigma_0^2 - \sigma_{\nu}^2)}{(\beta + \gamma)^{3/2}}\exp\left(- \frac{\left(\mu - X_0\right)^2}{2(\beta + \gamma)(\sigma_K^2 + \sigma_0^2 - \sigma_{\nu}^2)^{-1}}\right)(\mu - X_0)
\end{align*}

Finally,
\begin{align*}
X_1 = X_0 -\frac{(\sigma_K^2 + \sigma_0^2)(\sigma_K^2 + \sigma_0^2 - \sigma_{\nu}^2)}{(\beta + \gamma)^{3/2}}\exp\left(- \frac{\left(\mu - X_0\right)^2}{2(\beta + \gamma)(\sigma_K^2 + \sigma_0^2 - \sigma_{\nu}^2)^{-1}}\right)(\mu - X_0) \Delta t + \sqrt{2\lambda}\Delta W_1
\end{align*}
But what is the distribution of $X_1$?

\section{Non-explosion condition}
\begin{align*}
\int \nu(dy)\nabla K(x, y)&= \int \N(y; \mu, \sigma_{\nu}^2)\frac{y - x}{\sigma_K^2}\N(y; x, \sigma_K^2)\ dy\\
&= \frac{(\mu -1)\sigma_K^2+(x-1)\sigma_\nu^2}{\sigma_K^2(\sigma_K^2 + \sigma_\nu^2)^2}\N(x; \mu, \sigma_K^2+\sigma_\nu^2)
\end{align*}


\section{KL}
For this example we can also compute the value of
\begin{align*}
E(\rho) = \KL(\nu, \rho K) - \lambda \text{Ent}(\rho)
\end{align*}
if we assume that $\rho(x)$ is $\N(x; \mu, \sigma^2)$.

We have
\begin{align*}
E(\rho) = \frac{1}{2}\log \frac{\sigma^2 + \sigma^2_K}{\sigma^2_{\nu}} + \frac{\sigma^2_{\nu}}{2(\sigma^2 + \sigma^2_K)} - \frac{1}{2} - \lambda \left(\frac{1}{2} + \frac{1}{2}\log(2\pi \sigma^2)\right)
\end{align*}
differentiating w.r.t. $\sigma^2$:
\begin{align*}
&\frac{1}{2} \frac{1}{\sigma^2 + \sigma^2_K} - \frac{\sigma^2_{\nu}}{2(\sigma^2 + \sigma^2_K)^2} - \frac{\lambda }{2\sigma^2} = 0\\
&\frac{1}{\sigma^2 + \sigma^2_K} - \frac{\sigma^2_{\nu}}{(\sigma^2 + \sigma^2_K)^2} - \frac{\lambda }{\sigma^2} = 0\\
& \frac{\sigma^2(\sigma^2 + \sigma^2_K) - \sigma^2\sigma_{\nu}^2 - \lambda(\sigma^2 + \sigma^2_K)^2}{\sigma^2(\sigma^2 + \sigma^2_K)^2} = 0\\
& \sigma^4(1 - \lambda) + \sigma^2(\sigma_K^2 - \sigma_{\nu}^2 - 2\lambda\sigma_K^2) - \lambda\sigma_K^4 = 0\\
\end{align*}
setting $t= \sigma^2$ we get the second order equation
\begin{align*}
t^2(1 - \lambda) + t(\sigma_K^2 - \sigma_{\nu}^2 - 2\lambda\sigma_K^2) - \lambda\sigma_K^4 = 0.
\end{align*}
For $\lambda = 0$ we get $t^2 + t(\sigma_K^2 - \sigma_{\nu}^2)= 0$ whose solution is the solution of the EM approach. For $\lambda = 1$ we get $ -t(\sigma_K^2 + \sigma_{\nu}^2) - \sigma_K^4 = 0$ which has no solutions. For $\lambda \neq 1$
\begin{align*}
t_{1, 2} = \frac{-(\sigma_K^2 - \sigma_{\nu}^2 - 2\lambda\sigma_K^2) \pm \sqrt{\sigma_K^4 + \sigma_{\nu}^4 - 2\sigma_K^2\sigma_{\nu}^2(1 - 2\lambda)}}{2(1 - \lambda)}.
\end{align*}

The solution is then given by
\begin{align*}
\sigma^2(\lambda) = \frac{-(\sigma_K^2 - \sigma_{\nu}^2 - 2\lambda\sigma_K^2) + \sqrt{\sigma_K^4 + \sigma_{\nu}^4 - 2\sigma_K^2\sigma_{\nu}^2(1 - 2\lambda)}}{2(1 - \lambda)}
\end{align*}
which is positive for $\lambda<1$.
\end{document}

